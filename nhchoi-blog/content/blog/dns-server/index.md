---
title: DNS(Domain Name System)
date: "2024-07-07T04:00:00"
description: "도메인 주소를 IP 주소로 변환한다."
tags: ["Network"]
---
운영체제의 네트워크 API는 도메인이 아닌 IP 주소를 사용하여 통신하기 때문에, 도메인 주소를 IP 주소로 변환하는 과정이 필요하다.<br/>
이 과정에서 **DNS 서버**가 사용된다.<br/>

DNS 서버에 조회 메세지를 보내고 응답을 받는 클라이언트를 "**DNS 리졸버**"라고 한다. <br/>

1. DNS 리졸버는 사용자가 입력한 도메인을 기반으로 **DNS 쿼리**를 만든다.
2. DNS 쿼리를 전송하기 위해 **네트워크 스택**을 호출한다.
3. 네트워크 스택이 DNS 쿼리를 DNS 서버에 **전송**하고 **응답**을 받는다.

위 과정이 DNS 서버의 통신 과정을 간략하게 설명한 것이다.

그렇다면 **DNS 쿼리**에는 무슨 내용이 들어갈까?

- **이름** : 도메인의 이름
- **레코드 타입** : 요청하는 정보의 유형
  - A 타입(IP 주소)
  - MX 타입(메일 서버)
  - etc
- **클래스**: IN 클래스(인터넷)
  - 인터넷 이외의 네트워크는 거의 소멸되었기 때문에 항상 IN을 쓴다고 생각해도 좋다.

DNS 쿼리를 받은 DNS 서버는 일치하는 정보를 찾고 해당하는 **리소스 레코드**를 응답한다.
- 리소스 레코드 : 도메인 정보를 담고있는 주소록의 개념

> **MX 타입** <br/>
> MX 타입(메일 서버 타입)은 도메인과 우선 순위가 함께 저장이 되어있다.<br/>
> (숫자가 낮을 수록 우선 순위가 높다.)<br/>
> DNS 쿼리를 받으면 MX 리소스 레코드의 **목록**을 보낸다. <br/>
> DNS 리졸버는 우선순위가 높은 메일 서버 선택 후 추가 DNS 쿼리를 보내게 된다.


하지만 현실의 인터넷에서는 막대한 수의 서버가 존재한다.<br/>
1대의 DNS 서버에 모든 도메인을 등록하는 것은 역시 불가능하다.<br/>
이를 분산시켜서 다수의 DNS 서버에 등록하고 서로 연대하여 정보를 찾는다.<br/>

그전에 도메인에 대해 간단히 이해해보자.

#### 도메인
인터넷에서 네트워크 서비스를 식별하고 접근하기 위해 사용하는 고유의 이름.<br/>
**점(.)으로 구분된 계층구조를 가진다.**<br/>
예를 들어, **www.example.com** 는 아래와 같은 계층구조로 구분할 수 있다.<br/>
**www** - 하위 도메인, **example** - 2차 도메인(SLD), **com** - 최상위 도메인(TLD)

DNS 서버는 수만대나 있기 때문에 모든 서버를 다 찾는 건 현실적으로 불가능하다.<br/>
이 때 도메인의 계층 구조를 활용할 수 있다.

하위 도메인을 담당하는 DNS 서버의 IP 주소를 상위 DNS 서버에 등록하는 것이다.<br/>
그리고 `kr`, `com`과 같은 최상위 도메인 위에 **루트 도메인**을 두고, <br/>
마지막으로 **루트 도메인의 DNS 서버를 인터넷이 존재하는 DNS 서버에 전부 등록을 하면 된다**.

이로써 루트 도메인에서부터 차례로 아래쪽으로 거슬러 내려가며 원하는 DNS 서버를 찾을 수 있게 되었다!

그러면 `www.example.com`의 IP 주소를 묻는 과정에 대해 예시를 들어보자.

1. 클라이언트가 가까운 DNS 서버(로컬 DNS 서버)에 `www.example.com`의 IP 주소를 묻는다.
2. 로컬 DNS 서버는 루트 DNS 서버에게 "."(루트) 도메인에 대한 쿼리를 보냅니다. 
3. 루트 DNS 서버는 최상위 도메인(.com)의 DNS 서버 주소를 반환한다.
4. 로컬 DNS 서버는 ".com" 도메인의 DNS 서버에게 `www.example.com`의 IP 주소를 묻는다.
5. ".com" 도메인의 DNS 서버는 "example.com" 도메인의 DNS 서버 주소를 반환한다.
6. 로컬 DNS 서버는 "example.com" 도메인의 DNS 서버에게 `www.example.com`의 IP 주소를 묻는다.
7. "example.com" 도메인의 DNS 서버는 `www.example.com`의 IP 주소를 반환한다.
8. 로컬 DNS 서버는 클라이언트에게 `www.example.com`의 IP 주소를 전달한다.

사실 DNS 서버는 **캐시**를 사용하기 때문에 실제 동작은 위의 예시와 차이가 있을 수 있다.<br/>
**DNS 서버는 한 번 조사한 이름을 캐시에 기록하고, 조회한 이름에 해당하는 정보가 캐시에 있으면 그 위치부터 찾기 시작한다.** <br/>
하지만, 캐시에 저장된 후 정보가 변경되는 일도 있으므로 일정기간이 지나면 삭제한다.<br/>
또한 클라이언트에게 IP 주소를 전달할 때 캐시에서 가져온 정보인지 DNS 서버에서 가져온 정보인지 알려준다.


